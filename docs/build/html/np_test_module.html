<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>np_test &mdash; ImageLCM 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="analysis module" href="analysis.html" />
    <link rel="prev" title="write module" href="write.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            ImageLCM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="md_files/markdown_index.html">General Model Information</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">ImageLCM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="convert_outfiles.html">convert_outfiles module</a></li>
<li class="toctree-l2"><a class="reference internal" href="landalloc.html">landalloc module</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">parameters module</a></li>
<li class="toctree-l2"><a class="reference internal" href="read.html">read module</a></li>
<li class="toctree-l2"><a class="reference internal" href="write.html">write module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">np_test</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.adjust_demand_surpassers"><code class="docutils literal notranslate"><span class="pre">adjust_demand_surpassers()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.compute_largest_fraction_np"><code class="docutils literal notranslate"><span class="pre">compute_largest_fraction_np()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.denan_integration_input"><code class="docutils literal notranslate"><span class="pre">denan_integration_input()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.fill_grass"><code class="docutils literal notranslate"><span class="pre">fill_grass()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.find_relevant_cells"><code class="docutils literal notranslate"><span class="pre">find_relevant_cells()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.find_sorted_indices"><code class="docutils literal notranslate"><span class="pre">find_sorted_indices()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.flatten_rasters"><code class="docutils literal notranslate"><span class="pre">flatten_rasters()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.generate_fractions"><code class="docutils literal notranslate"><span class="pre">generate_fractions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.integrate_r1_fractions"><code class="docutils literal notranslate"><span class="pre">integrate_r1_fractions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.integration_allocation"><code class="docutils literal notranslate"><span class="pre">integration_allocation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.np_first_reallocation"><code class="docutils literal notranslate"><span class="pre">np_first_reallocation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.return_npdemand_map"><code class="docutils literal notranslate"><span class="pre">return_npdemand_map()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.rework_reallocation"><code class="docutils literal notranslate"><span class="pre">rework_reallocation()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.unflatten_rasters"><code class="docutils literal notranslate"><span class="pre">unflatten_rasters()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.write_inputs"><code class="docutils literal notranslate"><span class="pre">write_inputs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#np_test_module.write_regs"><code class="docutils literal notranslate"><span class="pre">write_regs()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html">analysis module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="md_files/Documentation%20Style.html">Documentation Style</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ImageLCM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">ImageLCM</a></li>
      <li class="breadcrumb-item active">np_test</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/np_test_module.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-np_test_module">
<span id="np-test"></span><h1>np_test<a class="headerlink" href="#module-np_test_module" title="Permalink to this heading"></a></h1>
<p>Generates test outputs using a combination of numpy and vanilla Python
to ensure that the LUE integration and allocation functions are
functioning properly.</p>
<p>NB: grazing intensities and management factors, as well as harvest
fractions are omitted in this test, as they are all constants and so do
not affect the behaviour of the functions as such.</p>
<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.adjust_demand_surpassers">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">adjust_demand_surpassers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cell_fracs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prod_reg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yield_facs_cell</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">demands_reg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">incl_grass</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.adjust_demand_surpassers" title="Permalink to this definition"></a></dt>
<dd><p>Identify whether there are overproduced crops in a cell; fix as needed</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cell_fracs</strong> (<em>np.ndarray</em>) – 1D array of length # crops, containing the initial
allocations of crop fractions to either the  current cell
or part of the current cell remaining, following an
earlier re-working of the allocation</p></li>
<li><p><strong>prod_reg</strong> (<em>np.ndarray</em>) – 1D array of length # crops, containing the crop production
in the region to which the cell belongs, up to this cell</p></li>
<li><p><strong>yield_facs_cell</strong> (<em>np.ndarray</em>) – 1D array of length # crops, containing the factors
by which each crop fraction of the current cell
should be multiplied to find the projeced yield</p></li>
<li><p><strong>demands_reg</strong> (<em>np.ndarray</em>) – 1D array of length # crops, containing the crop demands
in the region to which the cell belongs</p></li>
<li><p><strong>incl_grass</strong> (<em>bool</em><em>, </em><em>default = True</em>) – True if grass production is to be checked; False if not</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>cell_fracs</strong> – updated crop fractions in the current cell</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.compute_largest_fraction_np">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">compute_largest_fraction_np</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fracs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nan_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.compute_largest_fraction_np" title="Permalink to this definition"></a></dt>
<dd><p>Finds crop with largest fraction (and what the fraction is), cellwise</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fracs</strong> (<em>np.ndarray</em>) – 3D array with shape (#n_crops+grass, # n_lat, #_lon)</p></li>
<li><p><strong>save</strong> (<em>bool</em><em>, </em><em>default = False</em>) – if true, save outputs in .npy format</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mac</strong> (<em>np.ndarray</em>) – 2D array containing the most allocated crop, for all cells</p></li>
<li><p><strong>mfrac</strong> (<em>np.ndarray</em>) – 2D array containing the largest crop fraction, for all cells</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.denan_integration_input">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">denan_integration_input</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'float'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.denan_integration_input" title="Permalink to this definition"></a></dt>
<dd><p>Takes in inputs to integration functions and converts nans to zeros</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>array</strong> (<em>np.ndarray</em>) – </p></li>
<li><p><strong>dtype</strong> (<em>str</em><em>, </em><em>default = 'float'</em>) – datatype of array; must be either int or float</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>new_array</strong> – array of same dimensions as array</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.fill_grass">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">fill_grass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fracs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ir_frac</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.fill_grass" title="Permalink to this definition"></a></dt>
<dd><p>Fill remainder of cells featuring irrigated crops with grass</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fracs</strong> (<em>np.ndarray</em>) – 2D array containing the crop fractions for grass and rain-fed
food crops, with spatial coordinated reduced to one dimension</p></li>
<li><p><strong>ir_frac</strong> (<em>np.ndarray</em>) – 1D array containing the total fraction of each cell
allocated to irrigated crops, used to ensure normalisation</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>fracs</strong> – updated crop flattened crop fractions</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.find_relevant_cells">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">find_relevant_cells</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">is_cropland</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expansion</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.find_relevant_cells" title="Permalink to this definition"></a></dt>
<dd><p>Determines cells that are to be (re)allocated</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>is_cropland</strong> (<em>np.ndarray</em>) – 2D array of bools with value True for cells belonging to
the cropland LCT and False otherwise</p></li>
<li><p><strong>expansion</strong> (<em>bool</em><em>, </em><em>default = False</em>) – whether cropland is being expanded. If so, current
cropland allocation will not be altered</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>cells_relevant</strong> – flattened array stating whether cells are to be
(re)allocated</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.find_sorted_indices">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">find_sorted_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">suit_map</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.find_sorted_indices" title="Permalink to this definition"></a></dt>
<dd><p>Finds indices to sort flattened arrays by suitability in desc. order</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>suit_map</strong> (<em>np.ndarray</em>) – 2D np array containing the suitabilities for each cell</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>sorted_args</strong> – 1D np array with containing the indices for the
suitability-sorted arrays</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.flatten_rasters">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">flatten_rasters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raster_like</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.flatten_rasters" title="Permalink to this definition"></a></dt>
<dd><p>Flattens raster-like arrays (or stacks of rasters) to 1D (2D) arrays</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>raster_like</strong> (<em>np.ndarray</em>) – 2D or 3D array to be converted into a 1D or 2D array
with the spatial dimensions being reduced to a
single dimension</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>flattened_raster_like</strong> – array with 1 dimension fewer than raster_like</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.generate_fractions">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">generate_fractions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_cropland</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.generate_fractions" title="Permalink to this definition"></a></dt>
<dd><p>Generates initial fractions on initial cropland.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> (<em>tuple</em><em> of </em><em>ints</em><em>, </em><em>default =</em><em> (</em><em>20</em><em>, </em><em>10</em><em>)</em>) – desired shape of the array</p></li>
<li><p><strong>is_cropland</strong> (<em>np.ndarray</em>) – 2D Boolean array stating whether each element is
cropland</p></li>
<li><p><strong>nc</strong> (<em>int</em>) – number of crops (not including grass)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>fractions</strong> – 3D array containing the crop fractions for every cell, for
every crop</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.integrate_r1_fractions">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">integrate_r1_fractions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">integrands</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regs_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">demand_maps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suit_map_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ir_yields</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.integrate_r1_fractions" title="Permalink to this definition"></a></dt>
<dd><p>Integrates fractions returned by the first reallocation of cropland</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>integrands</strong> (<em>np.ndarray</em>) – np array of shape (n_crops+1, n_lat, n_lon) containing
the quantity to be integrated (crop fractions multiplied
by the potential yield, area and relevant constants)</p></li>
<li><p><strong>regs</strong> (<em>np.ndarray</em>) – np array containing the regions for every cell in the map</p></li>
<li><p><strong>demand_maps</strong> (<em>np.ndarray</em>) – np array of shape (#crops+grass, #lat, #lon), containing
the ratio in demands for each cell (same value for all
cells in a given region)</p></li>
<li><p><strong>suit_map</strong> (<em>np.ndarray</em>) – 2D np array containing the suitabilities for each cell</p></li>
<li><p><strong>ir_yields</strong> (<em>np.ndarray</em><em>, </em><em>default = None</em>) – array of shape (NFC, N_REG) containing the total regional
yields for all irrigated crops in all regions</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>integrated_maps</strong> (<em>np.ndarray</em>) – np array of shape (n_crops+1, n_lat, n_lon)
containing the integrated quantity (regional crop
production, summed over cells in order of
suitability)</p></li>
<li><p><strong>demands_met</strong> (<em>np.ndarray</em>) – np array of booleans of same shape as fracs_r1 stating
whether the regional demand for each crop has been met
yet in each cell</p></li>
<li><p><strong>regional_prod</strong> (<em>np.ndarray</em>) – np array of shape (n_regions, n_crops+1) containing
the production of each crop by each region</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.integration_allocation">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">integration_allocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sdp_facs_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yield_facs_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_fracs_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regs_flat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suit_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reg_demands</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cells_relevant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_reg_prod</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ir_frac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.integration_allocation" title="Permalink to this definition"></a></dt>
<dd><p>Allocates new land (or remaining cropland fracs) based on summed yield</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sdp_facs_flat</strong> (<em>np.ndarray</em>) – array of shape (# crops, # cells in map) containing
sdpf=1000*grmppc/maxPR for each crop and cell, units
of [1000km^2 / T]</p></li>
<li><p><strong>yield_facs_flat</strong> (<em>np.ndarray</em>) – array of shape (# crops, # cells in map) containing
the factor by which to multiply crop fractions to
compute the yield of the crop in that cell in [kT]</p></li>
<li><p><strong>old_fracs_flat</strong> (<em>np.ndarray</em>) – array of shape (# crops, # cells in map) containing
the pre-allocated crop fractions to be checked and
altered accordingly</p></li>
<li><p><strong>regs_flat</strong> (<em>np.ndarray</em>) – flattened array stating the region to which each cell
belongs</p></li>
<li><p><strong>suit_map</strong> (<em>np.ndarray</em>) – 2D array containing the suitability of each cell in the map</p></li>
<li><p><strong>reg_demands</strong> (<em>np.ndarray</em>) – array of shape (# regions, # crops) containing the crop
demands by region and crop</p></li>
<li><p><strong>cells_relevant</strong> (<em>np.ndarray</em>) – flattened array stating whether cells are to be
(re)allocated</p></li>
<li><p><strong>initial_reg_prod</strong> (<em>np.ndarray</em><em>, </em><em>default = None</em>) – array of shape (# regions, # crops) containing the
unchangeable cop production that is already
accounted for by region and crop. Unchangeable crop
production refers to irrigated crop yields if
expansion=False; crop yields from existing cropland
if expansion=True</p></li>
<li><p><strong>ir_frac</strong> (<em>np.ndarray</em><em>, </em><em>default = None</em>) – 1D array containing the total fraction of each cell
allocated to irrigated crops, used to ensure normalisation</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>new_fracs_flat</strong> (<em>np.ndarray</em>) – array of shape (# crops, # latitudes * # longitudes)
containing the updated crop fractions</p></li>
<li><p><strong>reg_prod</strong> (<em>np.ndarray</em>) – array of shape (# regions, # crops) containing the updated
regional production of each crop</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.np_first_reallocation">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">np_first_reallocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(10,</span> <span class="pre">20)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.np_first_reallocation" title="Permalink to this definition"></a></dt>
<dd><p>Performs first step of reallocating existing cropland; saves result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> (<em>tuple</em><em> of </em><em>ints</em><em>, </em><em>default =</em><em> (</em><em>10</em><em>, </em><em>20</em><em>)</em>) – desired shape of the array, with orientation
(longitude, latitude)</p></li>
<li><p><strong>nr</strong> (<em>int</em><em>, </em><em>default = 1</em>) – number of regions (stand-ins for IMAGE world-regions)</p></li>
<li><p><strong>nc</strong> (<em>int</em><em>, </em><em>default = 3</em>) – number of crops (not including grass)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.return_npdemand_map">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">return_npdemand_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">demand_ratios</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.return_npdemand_map" title="Permalink to this definition"></a></dt>
<dd><p>Puts demand ratios onto a 2D array, by region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>demand_ratios</strong> (<em>np.ndarray</em>) – np array with shape (#regions, #crops+grass)</p></li>
<li><p><strong>regs</strong> (<em>np.ndarray</em>) – 2D array of ints showing the region each array entry is in</p></li>
<li><p><strong>nr</strong> (<em>int</em><em>, </em><em>default = 1</em>) – number of regions (stand-ins for IMAGE world-regions)</p></li>
<li><p><strong>nc</strong> (<em>int</em><em>, </em><em>default=3</em>) – number of crops (not including grass)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>demand_maps</strong> – np array of shape (#crops+grass, #lat, #lon), containing
the ratio in demands for each cell (same value for all
cells in a given region)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.rework_reallocation">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">rework_reallocation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fracs_r1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">demands_met</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.rework_reallocation" title="Permalink to this definition"></a></dt>
<dd><p>Delete reallocated fractions where demand is surpassed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fracs_r1</strong> (<em>np.ndarray</em>) – np array of shape (n_crops+1, n_lat, n_lon) containing
the crop fractions resulting from the initial reallocation
of existing cropland</p></li>
<li><p><strong>demands_met</strong> (<em>np.ndarray</em>) – np array of booleans of same shape as fracs_r1 stating
whether the regional demand for each crop has been met
yet in each cell</p></li>
<li><p><strong>regs</strong> (<em>np.ndarray</em>) – np array containing the regions for every cell in the map</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>fracs_r2</strong> – The resulting array once the fractions allocated to crops
for which regional demand has already been met has been set
to zero</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.unflatten_rasters">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">unflatten_rasters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">flattened_raster_like</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shape</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.unflatten_rasters" title="Permalink to this definition"></a></dt>
<dd><p>Unflattens raster-like arrays (or stacks of rasters) to 2D (3D) arrays</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>flatened_raster_like</strong> (<em>np.ndarray</em>) – n=1- or 2-D array with the spatial dimensions
reduced to a single dimension, to be converted
to an array with dimensions n+1</p></li>
<li><p><strong>shape</strong> (<em>tuple</em>) – shape of the desired spatial dimenions in cells</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>raster_like</strong> – array with 1 (spatial) dimension more than
flattened_raster_like</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.write_inputs">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">write_inputs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(10,</span> <span class="pre">20)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.write_inputs" title="Permalink to this definition"></a></dt>
<dd><p>Writes the input arrays for the test.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> (<em>tuple</em><em> of </em><em>ints</em><em>, </em><em>default =</em><em> (</em><em>10</em><em>, </em><em>20</em><em>)</em>) – desired shape of the array, with orientation
(longitude, latitude)</p></li>
<li><p><strong>nr</strong> (<em>int</em>) – number of regions (stand-ins for IMAGE world-regions)</p></li>
<li><p><strong>nc</strong> (<em>int</em>) – number of crops (not including grass)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="np_test_module.write_regs">
<span class="sig-prename descclassname"><span class="pre">np_test_module.</span></span><span class="sig-name descname"><span class="pre">write_regs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_land</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a_r</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#np_test_module.write_regs" title="Permalink to this definition"></a></dt>
<dd><p>Writes the regions input array for the test.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> (<em>tuple</em><em> of </em><em>ints</em><em>, </em><em>default =</em><em> (</em><em>20</em><em>, </em><em>10</em><em>)</em>) – desired shape of the array</p></li>
<li><p><strong>is_land</strong> (<em>np.ndarray</em>) – 2D Boolean array stating whether each element is land</p></li>
<li><p><strong>nr</strong> (<em>int</em>) – number of regions (stand-ins for IMAGE world-regions)</p></li>
<li><p><strong>a_r</strong> (<em>np.ndarray</em>) – np array of shape (1, 2) containing the aspect ratio of the array</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>regs</strong> – 2D array of ints showing the region each array entry is in</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="write.html" class="btn btn-neutral float-left" title="write module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="analysis.html" class="btn btn-neutral float-right" title="analysis module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Ben Romero-Wilcock.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>